1/
if iptables block IGMP, you should see log which looks like the following:

	kernel: IPTables-Dropped: IN=virbr0 OUT=virbr0 PHYSIN=vnet2 PHYSOUT=vnet1 SRC=192.168.122.6 DST=224.0.0.22 LEN=40 TOS=0x00 PREC=0xC0 TTL=1 ID=0 DF PROTO=2 
	kernel: IPTables-Dropped: IN=virbr0 OUT=virbr0 PHYSIN=vnet1 PHYSOUT=vnet3 SRC=192.168.122.5 DST=224.0.0.22 LEN=40 TOS=0x00 PREC=0xC0 TTL=1 ID=0 DF PROTO=2



To accept IGMP traffic, put this in the libvirt network filter:

  <rule action='accept' direction='in' priority='500'>
    <igmp/>
  </rule>



2/
BUG in linux kernel: bridges drop multicast paquets. This is a workaround :
-> https://bugzilla.redhat.com/show_bug.cgi?id=902922
-> http://troglobit.com/blog/2013/07/09/multicast-howto/

  echo 0 > /sys/devices/virtual/net/virbr0/bridge/multicast_snooping















iptables -I INPUT 18 -p udp -m udp -s 192.168.122.0/24 -d 192.168.122.1 -j ACCEPT
iptables -I FORWARD 7 -j LOG -m limit --limit 2/min --log-prefix "IPTables-Dropped-FORWARD: " --log-level 4
iptables -I OUTPUT 1 -j LOG -m limit --limit 2/min --log-prefix "IPTables-Dropped-OUTPUT: " --log-level 4

   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
 [root@gcornet ~]# service iptables status
Table: nat
Chain PREROUTING (policy ACCEPT)
num  target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
num  target     prot opt source               destination         
1    MASQUERADE  tcp  --  192.168.122.0/24    !192.168.122.0/24    masq ports: 1024-65535 
2    MASQUERADE  udp  --  192.168.122.0/24    !192.168.122.0/24    masq ports: 1024-65535 
3    MASQUERADE  all  --  192.168.122.0/24    !192.168.122.0/24    

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         

Table: mangle
Chain PREROUTING (policy ACCEPT)
num  target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
num  target     prot opt source               destination         
1    CHECKSUM   udp  --  0.0.0.0/0            0.0.0.0/0           udp dpt:68 CHECKSUM fill 

Table: filter
Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         
1    libvirt-host-in  all  --  0.0.0.0/0            0.0.0.0/0           
2    ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0           udp dpt:53 
3    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:53 
4    ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0           udp dpt:67 
5    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:67 
6    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
7    ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0           state NEW udp dpt:123 
8    ACCEPT     tcp  --  10.0.0.0/8           0.0.0.0/0           state NEW tcp dpt:22 
9    ACCEPT     tcp  --  172.16.0.0/16        0.0.0.0/0           state NEW tcp dpt:22 
10   ACCEPT     tcp  --  192.168.122.0/24     0.0.0.0/0           state NEW tcp dpt:22 
11   ACCEPT     tcp  --  192.168.122.0/24     0.0.0.0/0           state NEW tcp dpt:6060 
12   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:1720 
13   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:1731 
14   ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0           udp dpt:5060 
15   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:5060 
16   ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0           udp dpts:5000:5999 
17   ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           icmp type 255 
18   ACCEPT     udp  --  192.168.122.0/24     192.168.122.1       udp 
19   LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped: ' 
20   REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited 

Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         
1    libvirt-in  all  --  0.0.0.0/0            0.0.0.0/0           
2    libvirt-out  all  --  0.0.0.0/0            0.0.0.0/0           
3    libvirt-in-post  all  --  0.0.0.0/0            0.0.0.0/0           
4    ACCEPT     all  --  0.0.0.0/0            192.168.122.0/24    state RELATED,ESTABLISHED 
5    ACCEPT     all  --  192.168.122.0/24     0.0.0.0/0           
6    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
7    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FORWARD: ' 
8    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 
9    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         
1    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-OUTPUT: ' 

Chain FI-vnet0 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FI-vnet0: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FI-vnet1 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FI-vnet1: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FI-vnet2 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FI-vnet2: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FI-vnet3 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FI-vnet3: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FO-vnet0 (1 references)
num  target     prot opt source               destination         
1    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:22 state NEW 
2    ACCEPT     tcp  --  192.168.122.4        0.0.0.0/0           tcp spts:1:65535 dpts:1:65535 state NEW 
3    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:80 state NEW 
4    ACCEPT     udp  --  192.168.122.4        0.0.0.0/0           udp spts:1:65535 dpts:1:65535 state NEW 
5    ACCEPT     icmp --  192.168.122.4        0.0.0.0/0           state NEW 
6    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED 
7    ACCEPT     2    --  0.0.0.0/0            0.0.0.0/0           state NEW,ESTABLISHED ctdir REPLY
8    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FO-vnet0: ' 
9    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FO-vnet1 (1 references)
num  target     prot opt source               destination         
1    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:22 state NEW 
2    ACCEPT     tcp  --  192.168.122.6        0.0.0.0/0           tcp spts:1:65535 dpts:1:65535 state NEW 
3    ACCEPT     tcp  --  192.168.122.7        0.0.0.0/0           tcp spts:1:65535 dpts:1:65535 state NEW 
4    ACCEPT     tcp  --  192.168.122.4        0.0.0.0/0           tcp spts:1:65535 dpt:8009 state NEW 
5    ACCEPT     tcp  --  192.168.122.4        0.0.0.0/0           tcp spts:1:65535 dpt:8209 state NEW 
6    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9443 state NEW 
7    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9990 state NEW 
8    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9999 state NEW 
9    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9643 state NEW 
10   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:10190 state NEW 
11   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:10199 state NEW 
12   ACCEPT     udp  --  192.168.122.6        0.0.0.0/0           udp spts:1:65535 dpts:1:65535 state NEW 
13   ACCEPT     udp  --  192.168.122.7        0.0.0.0/0           udp spts:1:65535 dpts:1:65535 state NEW 
14   ACCEPT     icmp --  192.168.122.6        0.0.0.0/0           state NEW 
15   ACCEPT     icmp --  192.168.122.7        0.0.0.0/0           state NEW 
16   ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED 
17   ACCEPT     2    --  0.0.0.0/0            0.0.0.0/0           state NEW,ESTABLISHED ctdir REPLY
18   LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FO-vnet1: ' 
19   REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FO-vnet2 (1 references)
num  target     prot opt source               destination         
1    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:22 state NEW 
2    ACCEPT     tcp  --  192.168.122.6        0.0.0.0/0           tcp spts:1:65535 dpts:1:65535 state NEW 
3    ACCEPT     tcp  --  192.168.122.7        0.0.0.0/0           tcp spts:1:65535 dpts:1:65535 state NEW 
4    ACCEPT     tcp  --  192.168.122.4        0.0.0.0/0           tcp spts:1:65535 dpt:8009 state NEW 
5    ACCEPT     tcp  --  192.168.122.4        0.0.0.0/0           tcp spts:1:65535 dpt:8209 state NEW 
6    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9443 state NEW 
7    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9990 state NEW 
8    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9999 state NEW 
9    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:9643 state NEW 
10   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:10190 state NEW 
11   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:10199 state NEW 
12   ACCEPT     udp  --  192.168.122.6        0.0.0.0/0           udp spts:1:65535 dpts:1:65535 state NEW 
13   ACCEPT     udp  --  192.168.122.7        0.0.0.0/0           udp spts:1:65535 dpts:1:65535 state NEW 
14   ACCEPT     icmp --  192.168.122.6        0.0.0.0/0           state NEW 
15   ACCEPT     icmp --  192.168.122.7        0.0.0.0/0           state NEW 
16   ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED 
17   ACCEPT     2    --  0.0.0.0/0            0.0.0.0/0           state NEW,ESTABLISHED ctdir REPLY
18   LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FO-vnet2: ' 
19   REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain FO-vnet3 (1 references)
num  target     prot opt source               destination         
1    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp spts:1:65535 dpt:22 state NEW 
2    ACCEPT     tcp  --  192.168.122.5        0.0.0.0/0           tcp spts:1:65535 dpts:1:65535 state NEW 
3    ACCEPT     tcp  --  192.168.122.6        0.0.0.0/0           tcp spts:1:65535 dpt:5432 state NEW 
4    ACCEPT     tcp  --  192.168.122.7        0.0.0.0/0           tcp spts:1:65535 dpt:5432 state NEW 
5    ACCEPT     udp  --  192.168.122.5        0.0.0.0/0           udp spts:1:65535 dpts:1:65535 state NEW 
6    ACCEPT     icmp --  192.168.122.5        0.0.0.0/0           state NEW 
7    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED 
8    ACCEPT     2    --  0.0.0.0/0            0.0.0.0/0           state NEW,ESTABLISHED ctdir REPLY
9    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-FO-vnet3: ' 
10   REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain HI-vnet0 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-HI-vnet0: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain HI-vnet1 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-HI-vnet1: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain HI-vnet2 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-HI-vnet2: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain HI-vnet3 (1 references)
num  target     prot opt source               destination         
1    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state NEW 
2    RETURN     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    RETURN     2    --  0.0.0.0/0            0.0.0.0/0           state ESTABLISHED ctdir ORIGINAL
4    LOG        all  --  0.0.0.0/0            0.0.0.0/0           limit: avg 2/min burst 5 LOG flags 0 level 4 prefix `IPTables-Dropped-HI-vnet3: ' 
5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable 

Chain libvirt-host-in (1 references)
num  target     prot opt source               destination         
1    HI-vnet0   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet0 
2    HI-vnet1   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet1 
3    HI-vnet2   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet2 
4    HI-vnet3   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet3 

Chain libvirt-in (1 references)
num  target     prot opt source               destination         
1    FI-vnet0   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet0 
2    FI-vnet1   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet1 
3    FI-vnet2   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet2 
4    FI-vnet3   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-in vnet3 

Chain libvirt-in-post (1 references)
num  target     prot opt source               destination         
1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           PHYSDEV match --physdev-in vnet2 
2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           PHYSDEV match --physdev-in vnet1 
3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           PHYSDEV match --physdev-in vnet0 
4    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           PHYSDEV match --physdev-in vnet3 

Chain libvirt-out (1 references)
num  target     prot opt source               destination         
1    FO-vnet0   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-out vnet0 
2    FO-vnet1   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-out vnet1 
3    FO-vnet2   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-out vnet2 
4    FO-vnet3   all  --  0.0.0.0/0            0.0.0.0/0           [goto] PHYSDEV match --physdev-out vnet3 


